version: '3'

services:
  app:
    build: .
    container_name: flask_application
    ports:
      - 8000
    volumes:
      - ./wsgi.py:/code/wsgi.py
      - ./templates:/code/templates/

  nginx:
    build: ./docker/nginx
    container_name: nginx_server
    ports:
      - 5000:80
    depends_on:
      - app
    links:
      - app
    # volumes:
    #   - "nginx_error_logs:/var/log/nginx/error.log:ro"
    #   - "nginx_access_log:/var/log/nginx/access.log:ro"

  fail2ban:
    image: superitman/fail2ban
    container_name: fail2ban
    command: cp /docker/failtoban/entrypoint.sh ../start/ &&
              chmod +x ../start/entrypoint.sh
    entrypoint: ['entrypoint.sh']
    # network_mode: "host"
    # cap_add:
    #   - NET_ADMIN
    #   - NET_RAW
    # volumes:
    #   - "./data:/data"
    #   - "/var/log:/var/log:ro"
    restart: always

# volumes:
#   nginx_error_logs: {}
#   nginx_access_log: {}
